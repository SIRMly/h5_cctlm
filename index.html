<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache"/>
    <meta name="renderer" content="webkit"/>
    <meta name="author" content="SIRMly">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/index.css"/>
    <title>安仁乐道</title>
</head>
<body>
<!--<audio src="audio/tourBgm.mp3" loop preload="auto" id="bgm"></audio>-->
<div class="page page3" id="page3">
    <div class="bg"></div>
    <img src="img/pic3.png" alt="" class="pic"/>
    <img src="img/word3.png" alt="" class="word"/>
</div>
<div class="page page2" id="page2">
    <div class="bg"></div>
    <img src="img/pic2.png" alt="" class="pic"/>
    <img src="img/word2.png" alt="" class="word"/>
</div>
<div class="page page1" id="page1">
    <div class="bg"></div>
    <img src="img/pic1.png" alt="" class="pic"/>
    <img src="img/word1.png" alt="" class="word"/>
</div>
<div class="page" id="page0">
    <div id="progress"></div>
</div>
<div class="music"></div>
<div id="orientLayer" class="mod-orient-layer">
    <div class="mod-orient-layer__content">
        <i class="icon mod-orient-layer__icon-orient"></i>
        <div class="mod-orient-layer__desc">为了更好的体验，请使用竖屏浏览</div>
    </div>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/touch.min.js"></script>
<script>
    ;(function ($){
        var click = "ontouchstart" in document ? "touchend" : "click";
        document.addEventListener('touchmove', function (e) {
            e.preventDefault();
        });
        document.addEventListener("WeixinJSBridgeReady", function () {
        }, false);
//        var bgm = document.getElementById("bgm");
        var imgs = [
                "img/pic1.png",
                "img/word1.png",
                "img/bg1.png",
                "img/pic2.png",
                "img/word2.png",
                "img/bg2.png",
                "img/pic3.png",
                "img/word3.png",
                "img/bg3.png",
                "img/pic4.png",
                "img/word4.png",
                "img/bg4.png"
        ];
        preload(imgs);
        function preload(imgs,proBox){
            var proNum = 0,
                    count = imgs.length,
                    proPercentage = 0;
            for(var i in imgs){
                var newImg = new Image();
                newImg.src = imgs[i];
                newImg.onload = function (){
                    proNum++;
                    proPercentage = Math.floor(proNum/count*100);
                    $("#progress").width(proPercentage+"%");
                    if(proNum>=count){
                        proPercentage=100;
                        $("#page0").stop().fadeOut(500, function (){
                            $("#page0").addClass("hide");
                        });
                        $("#page1").stop().fadeIn(500);
//                        setTimeout(function(){
//                            $(".music").addClass("play");
//                            bgm.play();
//                            WeixinJSBridge.invoke('getNetworkType', {}, function (e) {
//                                bgm.play();
//                            });
//                        },100)
                        setTimeout(toNext(1),2500);
                    }
//                    proBox.html(proPercentage+"%");
                }
            }
        }
//        $(".music").on(click, function (){
//            if(bgm.paused){
//                bgm.play();
//                $(".music").addClass("play");
//            }else{
//                bgm.pause();
//                $(".music").removeClass("play");
//            }
//        });


        var nowIndex = 1;
        function toNext(index){
            if(nowIndex == index){
                touch.on("#page"+index, "swipeup", function (){
                    console.log(index);
                    nextPage(index, index+1);
                });
            }

        }
        function nextPage(thisPage, nextPage) {
            if(thisPage < 11 && thisPage > 0){
                $("#page"+thisPage).find("img,div").css("opacity",1);
                $("#page"+thisPage).addClass("fadeOut");
                $("#page"+nextPage).stop().fadeIn(200, function (){
                    setTimeout(function (){
                        $("#page"+thisPage).fadeOut(0);
                        nowIndex++;
                        toNext(nextPage);
                    }, 2500);
                });
            }
        }




    })(jQuery);
</script>
</body>
</html>